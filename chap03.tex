\chapter{Método Proposto}



% -.~.-.~.-.~.-.~.-.~.-.~.-.~.-.~.-.~.-.~.-.~.-
\section{Visão geral}

O método proposto divide-se nas seguintes etapas:

\missingfigure[figheight=100mm]{Diagrama do método}


% -.~.-.~.-.~.-.~.-.~.-.~.-.~.-.~.-.~.-.~.-.~.-
\section{Modelo do robô}

Nesta seção, são detalhados os procedimentos para representar o manipulador
robótico como um conjunto MBS e utilizá-lo para simular as trajetórias
referentes a uma determinada tarefa. O manipulador será descrito pelo conjunto
de Sistemas de Coordenadas (SC's) referente a cada uma de suas juntas, pelas
distâncias entre os SC's e posição dos centros de massa de cada elo, e pelos
parâmetros de massa e momento de inércia de cada elo. Os elos do robô e a
ferramenta acoplada no efetuador representam cada corpo do sistema MBS. A
modelagem do manipulador é simplificada utilizando as rotinas de CAS
desenvolvida especialmente para MBS, o Sophia, assim como a notação algébrica de
Lesser, apresentada na seção~\ref{sec::sophia-kane}.

\subsection{Descrição do braço robótico} \label{sec::descricao_mh12}

O manipulador escolhido para estudo é o mesmo que será utilizado no projeto EMMA
para revestimento de superfícies metálicas por HVOF. Trata-se de um robô
comercial modelo MH12, da série MOTOMAN, fabricado pela Yaskawa Motoman
(Figura~\ref{fig::mh12_foto}).

\begin{figure}[h]
    \centering
    \begin{subfigure}[b]{0.3\textwidth}
        \includegraphics[width=\textwidth]{figs/mh12_foto}
        \caption{MOTOMAN MH12. \\Fonte: adaptada de}
        \label{fig::mh12_foto}
    \end{subfigure}
    \quad %add desired spacing between images, e. g. ~, \quad, \qquad, \hfill
    % etc.
      %(or a blank line to force the subfigure onto a new line)
    \begin{subfigure}[b]{0.5\textwidth}
        \includegraphics[width=\textwidth]{figs/mh12_diagram}
        \caption{Diagrama dos elos e juntas. \\Fonte: adaptada de}
        \label{fig::mh12_diagram}
    \end{subfigure}
    \caption{Manipulador robótico para modelo}\label{fig::resumo_mh12}
    \todo[inline]{Inncluir referências das figuras - MH12 specsheet}
\end{figure}

\begin{table}[h]
\centering
\caption{Sistemas de coordenadas, elos e coordenadas generalizadas}
\label{tab::resumo_mh12}
\begin{tabular}{@{}clc@{}}
\toprule
SC & Elo              & \multicolumn{1}{l}{Coord. gen. associada} \\ \midrule
Z  & Pedestal do robô & -                                         \\
S  & \textit{Swivel}  & q1                                        \\
L  & Braço inferior   & q2                                        \\
U  & Braço superior   & q3                                        \\
R  & Braço de rolagem & q4                                        \\
B  & Pulso            & q5                                        \\
T  & Efetuador        & q6                                        \\ \bottomrule
\end{tabular}
\end{table}

Este robô é um braço antropomórfico de 6 juntas rotacionais e portanto 6 graus
de liberdade (6 gdl), contendo o último elo um porta-ferramentas que suporta uma
carga útil de até 12 kg. A Figura~\ref{fig::mh12_diagram} apresenta os nomes dos
elos e coordenadas generalizadas associados a cada um dos sistemas de
coordenadas e são resumidos na Tabela~\ref{tab::resumo_mh12}.

O alcance horizontal deste manipulador chega a 1,440~m, e vertical a
2,511~m. Estão representados no diagrama do espaço de trabalho na
Figura~\ref{fig::workspace} em que a área sombreada é formada por todos os
pontos alcançáveis pelo manipulador, dentro dos limites de cada junta.

\begin{figure}[h]
	\centering 
 	\includegraphics[width=0.7\textwidth]{figs/workspace}
 	\caption[Vistas lateral e superior do espaço de trabalho]{Vistas lateral e
 	superior do espaço de trabalho. \\Fonte: adaptada de}
 		\todo[inline]{Inncluir referência da figura - MH12 specsheet}
 	\label{fig::workspace}
\end{figure}

Conforme discutido na seção~\ref{sec::manind}, este tipo de braço robótico
permite desacoplar o sistema em 2 problemas: posicionamento e orientação. Logo,
para simplificar o modelo e o cálculo da cinemática inversa, serão consideradas
as 3 primeiras juntas para posicionamento e 3 últimas (pulso esférico) para
orientação da ferramenta.

A última junta, no efetuador, tem a finalidade de orientar a ferramenta em torno
do seu eixo axial. Como o processo de revestimento por HVOF independe desta
orientação, esta junta não será incluída, mantendo este acoplamento rígido, o
que transforma os dois últimos elos em apenas um corpo.
Como resultado, tem-se um sistema de 5 gdl.


\subsection{Cinemática Direta}\label{sec::dkin}

Como foi discutido na seção~\ref{sec::cinematica}, o procedimento mais utilizado
para a modelagem cinemática de manipuladores robóticos é o método dos parâmetros
de Denavit-Hartenberg (parâmetros D-H). Apesar de sua popularidade e vasta
utilização na modelagem cinemética de manipuladores variados, este método possui
regras que acabam restringindo uma livre escolha dos sistemas de coordenadas e
as direções dos eixos de referência. Dependendo da geometria do robô, pode ser
uma tarefa trabalhosa definir os parâmetros e referenciais mais convenientes, e
que resultem em um sistema final simplificado.

Um maior controle sobre a escolha dos referenciais e dos parâmetros da geometria
pode reduzir significativamente o custo computacional do modelo.
Neste sentido, o Sophia-Maple é uma ferramenta mais flexível, que permite, ao
usuário, total liberdade sobre a escolha dos referenciais, sem nenhum aumento de
complexidade de modelagem. Uma escolha estratégica da posição e orientação dos
sistemas de coordenadas pode resultar em equações cinemáticas e transformações de
referenciais mais simplificadas. Neste trabalho serão utilizadads as rotinas do
Sophia para modelagem da cinemática direta do manipulador robótico.

\subsubsection{Sistemas de Coordenadas e Transformações Homogêneas}

A primeira etapa para obter-se as equações cinemáticas será definir o sistema de
coordenadas fixo em cada elo do robô. A Figura~\ref{fig::scs} é um modelo CAD do
manipulador e apresenta a posição de cada SC, na sua configuração inicial.

\begin{figure}[h]
    \centering
    \begin{subfigure}[b]{0.20\textwidth}
        \includegraphics[width=\textwidth]{figs/sc_front}
        \caption{Vista frontal}
        \label{fig::sc_front}
    \end{subfigure}
    \quad %add desired spacing between images, e. g. ~, \quad, \qquad, \hfill
    % etc.
      %(or a blank line to force the subfigure onto a new line)
    \begin{subfigure}[b]{0.7\textwidth}
        \includegraphics[width=\textwidth]{figs/sc_lat}
        \caption{Vista lateral}
        \label{fig::sc_lat}
    \end{subfigure}
    \caption{Sistemas de coordenadas do robô}\label{fig::scs}
\end{figure}

Na vista frontal (Figura~\ref{fig::sc_front}) nota-se que foi escolhida uma
configuração em que todos os SC's estivessem no mesmo plano XY. Outra observação
é que os SC's R, B e T estão fixados no mesmo ponto. que representa a origem do
``pulso'' do braço robótico. Estas considerações reduzem a quantidade de termos
das equações cinemáticas. Também terão grande impacto no cálculo da cinemática
inversa, como será visto na seção~\ref{sec::ikin_mh12}.

Logo, pode-se escrever as relações entre estes referenciais em termos das
coordenadas generalizadas do sistema, para obter as transformações entre cada
SC. No Sophia-Maple isto é feito com o uso da função \texttt{chainSimpRot}, da
seguinte forma:

\medskip \noindent {\tt > chainSimpRot( [Z,S,1,q1], [S,L,3,q2], [L,U,3,q3],
[U,R,2,q4], [R,B,3,q5], [B,T,2,q6] )} \medskip 

Esta função cria as matrizes de rotação entre os referenciais do sistema,
informando a cada transformação, o eixo de rotação
(onde 1=X, 2=Y e 3=Z) e a coordenada generalizada associada
(q1,~\ldots~,q6). Foi utilizada a forma de coordenadas relativas entre cada SC.

Como exemplo, considere o termo {\tt [L,U,3,q3]}. Representa uma rotação de um
ângulo q3, do SC-U em relação ao SC-L, em torno do eixo Z.
Logo, a matriz Transformação Homogênea entre o referencial inercial Z e o braço
superior U seria:
%
$$ R_{Z}^{U} = R_{Z}^{S} R_{S}^{L} R_{L}^{U} $$
%
A função \texttt{Rmx} do Sophia-Maple retorna a matriz de rotação entre quaisquer
sistemas de coordenadas. No Sophia-Maple, escreve-se:

\medskip \noindent {\tt > Rmx(Z,U)} \medskip 

E obtém-se o resultado:
%
$$ R_{Z}^{U} = \left( \begin {array}{ccc} {\it c2}\,{\it c3}-{\it s2}\,{\it
s3}&-{ \it c2}\,{\it s3}-{\it s2}\,{\it c3}&0\\ \noalign{\medskip}{\it c1}\,{
\it c2}\,{\it s3}+{\it c1}\,{\it s2}\,{\it c3}&{\it c1}\,{\it c2}\,{
\it c3}-{\it c1}\,{\it s2}\,{\it s3}&-{\it s1}\\ \noalign{\medskip}{
\it s1}\,{\it c2}\,{\it s3}+{\it s1}\,{\it s2}\,{\it c3}&{\it s1}\,{
\it c2}\,{\it c3}-{\it s1}\,{\it s2}\,{\it s3}&{\it c1}\end {array}
 \right) $$
 %
 A matriz acima foi escrita em notação trigonométrica simplificada, em que c1,
 s1, ,c2, s2, \ldots, e assim por diante, representam as funções senos e
 cossenos dos ângulos das coordenadas generalizadas q1, \ldots, q5. Para melhor
 visualização das matrizes e equações, esta notação será utilizada em todo o
 trabalho.
 
\subsubsection{Vetores posição e centros de massa}

A segunda etapa é definir os vetores posição dos centros de massa de cada corpo.
Para isso, define-se auxiliarmente os vetores posição entre cada SC, desde o
referencial inercial Z até o efetuador em T. Será utilizada a notação de Lesser,
por meio dos \texttt{Evectors}, como descrito na seção~\ref{sec::sophia-kane}
para representar esses vetores.

Logo, de maneira geral, pode-se escrever a posição de qualquer ponto pela
seguinte relação:
%
\begin{align}
	^{Z}\mathbf{p}^{k} &= ~^{Z}\mathbf{p}^{k-1} + ~^{k-1}\mathbf{p}^{k} \\
	^{Z}\mathbf{pcm}^{k} &= ~^{Z}\mathbf{pcm}^{k-1} + ~^{k}\mathbf{pcm}^k
	\label{eq::pcm}
\end{align}
%
Onde $^{Z}\mathbf{p}^{k}$ é o vetor posição do referencial $k$ em relação ao
referencial inercial $Z$ e analogamente $^{Z}\mathbf{pcm}^{k}$ é o vetor
posição do centro de massa do corpo $k$, tal que $k$ varia em \{S,L,U,B,T\},
sistemas de coordenadas do robô.
No Sophia-Maple escreve-se:

\medskip \noindent {\tt > pZ:= Evector(0,0,0,Z)} \\
\noindent {\tt > for k from corpo[1] to corpo[6] do \\
\indent p||k:= p||{k-1} \&++ Evector(p||{k-1}||{k}||x, p||{k-1}||{k}||y,
\indent p||{k-1}||{k}||z, k-1) \\
end do:} \medskip 

E para os centros de massa:

\medskip \noindent {\tt > for k from corpo[1] to corpo[6] do \\
\indent pcm||k:= p||{k} \&++ Evector(pcm||{k}||x, pcm||{k}||y, pcm||{k}||z, k)
\\ end do:} \medskip 

\todo[inline]{Incluir figura com vetores posição e do robô esquemático do Maple}

\subsubsection{Velocidades}

As velocidades dos centros de massa de cada corpo são calculadas como a derivada
do vetor posição com respeito ao referencial inercial. Logo, a derivada da
equação~\ref{eq::pcm} em Z:
%
\begin{equation}
	\mathbf{v}^{k} = \frac{^{Z}\mathrm{d} }{\mathrm{d} t}
	\mathbf{pcm}^{k} \label{eq::veloc}
\end{equation}
%
O Sophia-Maple possui um poderoso conjunto de rotinas para diferenciação dos
\texttt{Evectors} com relação ao referencial inercial, por meio da função
\texttt{cdft}, que reconhece automaticamente o referencial em que cada vetor
está descrito e realiza o cálculo diferencial vetorial. Logo, pode-se escrever o
seguinte comando para definir as velocidades de acordo com a
equação~\ref{eq::veloc}:

\medskip \noindent {\tt > for k from corpo[1] to corpo[6] do \\
\indent v||k:= cdft(pcm||{k}, Z) \\
end do:} \medskip 

As velocidades angulares serão a taxa de variação angular das matrizes de
rotação entre os referenciais. Serão definidas as velocidades angulares de cada
corpo em relação ao referencial inercial. Conforme apresentado na
seção~\ref{sec::cinematica} pode-se escrever a velocidade angular de uma matriz
rotação $R(t)$ como:
%
\begin{equation}
	\frac{\mathrm{d} R}{\mathrm{d} t} = S \cdot R(t)
\end{equation}
%
Onde $S$ é o tensor velocidade angular associado a $\omega$.
%
\begin{align}
% eq1
& S = \begin{pmatrix}
0				& -\omega_{z}(t)	& \omega_{y}(t) \\ 
\omega_{z}(t)	& 0					& -\omega_{x}(t) \\ 
-\omega_{y}(t)	& \omega_{x}(t)		& 0
\end{pmatrix} \\
% eq2
& \boldsymbol{\omega} = [\omega_{x}, \omega_{y}, \omega_{z}]^{T}
\end{align}
%
No Sophia-Maple o tensor $S$ pode ser calculado através da função
\&\texttt{VtoD}. Por exemplo, o tensor entre os referenciais SC-L e SC-S seria:
%
$$
S_{L}^{Z} = \left( \begin {array}{ccc} 0&-{\it q2t}&-\sin \left( {\it q2}
 \right) {\it q1t}\\ \noalign{\medskip}{\it q2t}&0&-\cos \left( {\it 
q2} \right) {\it q1t}\\ \noalign{\medskip}\sin \left( {\it q2}
 \right) {\it q1t}&\cos \left( {\it q2} \right) {\it q1t}&0
\end {array} \right)
$$
%
Porém, pode-se ainda fazer o uso da função \texttt{aV} que
calcula diretamente o vetor velocidade angular $^{A}\omega^{B}$ entre dois
referenciais. O que retornaria o seguinte vetor:
%
$$
^{Z}\boldsymbol{\omega}^{L} = [-{\it q1t},\sin \left( {\it q1} \right) {\it q2t},-\cos
\left( {\it q1} \right) {\it q2t}]
$$
%
No caso do manipulador, são calculadas as velocidades de cada corpo em relação
ao referencial Z. São definidos da seguinte forma:

\medskip \noindent {\tt > for k from corpo[1] to corpo[6] do \\
\indent w||k:= aV(Z, corpo[k]) \\
end do:} \medskip 

Podemos finalmente escrever o vetor Velocidades Generalizadas, que nada mais é
que um \texttt{Kvector} que fornece a lista de \texttt{Evectors} referente às
velocidades lineares e angulares calculadas. Logo, o vetor velocidades
generalizadas tem a seguinte forma:
%
\begin{equation}
	v_{k} = [ v_{1},\ldots, v_{n}, \omega_{1},\ldots, \omega_{n}, 2n ]
\end{equation}
%
Onde cada termo do \texttt{Kvector} é um \texttt{Evector} da velocidade
generalizada.
Por fim, o último termo representa a quantidade de \texttt{Evectors} que formam o
\texttt{Kvector}.

\subsubsection{Hiperplano tangente}

Uma vez que as velocidades generalizadas foram definidas pode-se obter o
conjunto de vetores tangentes, pelo cálculo das velocidades parciais, que formam
o chamado hiperplano tangente.
Este plano é uma generalização da superfície que restringe o movimento do
sistema multicorpo e é obtido pela diferenciação das velocidades com respeito
às coordenadas generalizadas, conforme visto na seção~\ref{sec::cinematica}. As
velocidades parciais são calculadas pela expressão das velocidades
generalizadas, na equação~\ref{eq::velgen}. O termo explicitado na
equação~\ref{eq::tau} define o vetor tangente associado a i-ésima coordenada
generalizada.
%
\begin{gather}
%eq1
	^{R}\mathbf{v} = \frac{\mathrm{d} \mathbf{r}}{\mathrm{d} t} = \sum_{i}^{n}
	\dot{q_{i}} \frac{\partial r}{\partial q_{i}} + \frac{\mathrm{d}
	q_{i}}{\mathrm{d} t} \label{eq::velgen}\\
%eq2
	\dot{q_{i}} \frac{\partial r}{\partial q_{i}} = \tau_{i} \label{eq::tau}
\end{gather}
%
A função \texttt{KMtangents} do Sophia-Maple obtém os termos que formam os
vetores tangentes em \texttt{Kvectors} para cada coordenada generalizada. O
conjunto que forma o hiperplano tangente introduz uma estrutura do Sophia, dos
super \texttt{Kvectors}, ou \texttt{SKVector}. Esta estrutura facilitará a
projeção das equações dinâmicas no hiperplano tangente. Logo, para o manipulador
escreve-se:

\medskip \noindent {\tt > tau:= KMtangents(vK,u,6):} \medskip 


\subsection{Dinâmica}

Definida a cinemática direta do manipulador, deseja-se obter as forças de
inércia e externas generalizadas que fornecerão as equações de movimento do
sistema. Nesta seção primeiramente são introduzidos os parâmetros de inércia de
cada corpo do manipulador e como foram obtidos.

\subsubsection{Parâmetros de inércia do manipulador robótico}

Os parâmetros de inércia são a massa e o momento de inércia de cada corpo do
sistema. É importante notar que não é possível obter um modelo dinâmico preciso
apenas com as informações contidas nos manuais e fichas técnicas do manipulador
robótico. Infelizmente os parâmetros de inércia individuais de cada corpo não
são fornecidos pelos fabricantes e, portanto, serão estimados. 

Do manual do MOTOMAN MH12\todo{incluir ref: manual mh12}, tem-se que a massa
total do robô é de 130~kg. Também é disponibilizado, diretamente pelo
fabricante, um modelo CAD com ótimo detalhamento de cada corpo individualmente.

O programa SolidWorks foi utilizado para obter informações importantes do modelo
CAD, para a estimativa dos parâmetros de inércia. Nele é possível analisar cada
elo em separado e obter o seu volume. Com isso, pode-se obter uma massa específica
média do robô, de acordo com a equação~\ref{eq::rho}.
%
\begin{align}
	\rho_{m} = M_{total}\sum_{corpo[i]}^{corpo[n]} V_{i} \label{eq::rho} & &, i =
	Z,S,L,U,R,B,T
\end{align}
%
Logo, pode-se estimar a massa de cada corpo, calculada pelo produto da massa
específica média $\rho_{m}$ e o volume, de acordo com a
equação~\ref{eq::massai}.
%
\begin{align}
	m_{i} = \rho_{m} \cdot V_{i} \label{eq::massai} & &, i =
	Z,S,L,U,R,B,T
\end{align}
%
A massa da ferramenta acoplada ao efetuador foi obtida precisamente, pelo
projeto CAD do suporte, no SolidWorks, e informação do fabricante do dispositivo
HVOF.
A Tabela~\ref{tab::massa_mh12} apresenta os resultados da massa estimada em cada
corpo:
%
\begin{table}[h]
\centering
\caption{Resultado do cálculo da massa de cada corpo}
\label{tab::massa_mh12}
\begin{tabular}{@{}clc@{}}
\toprule
\textbf{Corpo}                      & \textbf{Volume} [$m^3$] & \multicolumn{1}{l}{\textbf{Massa} [kg]} \\ \midrule 
Z 									& 0,01595         & 40,5							   \\
S                                   & 0,01443         & 36,7                               \\
L                                   & 0,00579         & 14,7                               \\
U                                   & 0,00997         & 25,3                               \\
R                                   & 0,00399         & 10,1                               \\
B                                   & 0,00100         & 2,5                                \\
T                                   & 0,00005         & 0,13                               \\
Ferramenta                          & -		          & 5,97							   \\ \midrule
\textbf{Volume total}~$=$           & 0,05119        & \multicolumn{1}{c}{$m^3$}	       \\
\multicolumn{1}{r}{\textbf{$\rho_m =$}} & 2540          &
\multicolumn{1}{c}{$kg/{m^3}$}     \\ \bottomrule
\end{tabular}
\end{table}
%

Para este modelo dinâmico, não será utilizada a última junta do robô, como foi
explicado na seção~\ref{sec::descricao_mh12}, de forma que pode-se considerar os
corpos ``B, T e Ferramenta'' como um único corpo. Assim, as propriedades de
massa e momento de inércia podem ser somadas e condensadas em uma única
descrição. A partir deste ponto, estes 3 últimos corpos serão tratadaos como um
único corpo e será utilizada a denominação do corpo B para representar esse
conjunto, com seu sistema de referência fixado em SC-B.

As variáveis de massa de cada corpo são definidas no Sophia-Maple como grandezas
escalares, sem uso de qualquer função especial.

O programa SolidWorks também foi utilizado para obter as posições do centro de
massa e momentos de inércia de cada elo.
Foi considerado que a massa calculada é distribuida homogeneamente no volume.
Isto resulta na posição estimada, fornecida pelo programa. A
Tabela~\ref{tab::resumo_cm} resume os valores encontrados para a posição do
centro de massa com respeito ao referencial de cada elo e a
Figura~\ref{fig::pcm_mh12} ilustra no modelo CAD a posição aproximada.
%
\begin{table}[h]
\centering
\caption{Posição do centro de massa}
\label{tab::resumo_cm}
\begin{tabular}{@{}cccc@{}}
\toprule
\textbf{Corpo} & \textbf{x [m]} & \textbf{y [m]} & \textbf{z [m]} \\ \midrule
Z              & 0,079      & -0,050     & 0,000      \\
S              & 0,124      & 0,027      & 0,008      \\
L              & 0,281      & -0,025     & -0,115     \\
U              & 0,123      & 0,115      & -0,025     \\
R              & 0,039      & -0,224     & 0,004      \\
B              & -0,011     & 0,146      & 0,000      \\ \bottomrule
\end{tabular}
\end{table}
%

\begin{figure}[h]
	\centering 
 	\includegraphics[width=0.7\textwidth]{figs/pcm_mh12}
 	\caption{Posição aproximada dos centros de massa}
 	\label{fig::pcm_mh12}
\end{figure}

Agora podem ser obtidos os momentos de inércia de cada elo obtidos no
centro de massa e alinhados ao sistema de coordenadas daquele elo. O programa
fornece esses valores, que são apresentados a seguir.
%
\begin{align*}
InZ &=& \left( \begin {array}{ccc}  0,811& 0,293& 0,091\\ \noalign{\medskip}
 0,293& 0,695& 0,064\\ \noalign{\medskip} 0,091& 0,064& 0,923
\end {array} \right) & \quad InS &=& \left( \begin {array}{ccc}  0,811& 0,293& 0,091\\ \noalign{\medskip}
 0,293& 0,695& 0,064\\ \noalign{\medskip} 0,091& 0,064& 0,923
\end {array} \right) \\
InL &=&  \left( \begin {array}{ccc}  0,051&-
0,008&- 0,032 \\ \noalign{\medskip}- 0,008& 0,791& 0,011\\ \noalign{\medskip}- 0,032
& 0,011& 0,798\end {array} \right) & \quad InU &=& \left( \begin {array}{ccc} 
0,314& 0,149&- 0,077\\ \noalign{\medskip} 0,149& 0,367&- 0,057\\ \noalign{\medskip}- 0,077&- 0,057& 0,418
\end {array} \right) \\
InR &=&  \left( \begin {array}{ccc}  0,173&-
0,014& 0,001\\ \noalign{\medskip} - 0,014& 0,052& 0,004\\ \noalign{\medskip} 0,001& 0,004& 0,148
\end {array} \right) & \quad InB &=&  \left( \begin {array}{ccc}  0,235&- 0,018& 0,0\\ \noalign{\medskip}-
 0,018& 0,039& 0,0\\ \noalign{\medskip} 0,0& 0,0& 0,243\end {array}
 \right)
\end{align*}
%
No Sophia-Maple estes tensores são construidos com a função
\texttt{EinertiaDyad}, que aproveita o fato dos tensores de inércia serem
simétricos e recebe 6 argumentos para os termos da matriz e um para especificar
o sistema de coordenadas de referência em que foi obtido o tensor. Define-se
portanto cada tensor da seguinte forma:

\medskip \noindent {\tt > for i from corpo[1] to corpo[6] do \\
\indent In||(corpo[i]):= EinertiaDyad( \\
\indent In||(corpo[i])||11, In||(corpo[i])||22, \\
\indent In||(corpo[i])||33, In||(corpo[i])||12, \\
\indent In||(corpo[i])||13, In||(corpo[i])||23, sc[i]) \\
end do:}

\subsubsection{Quantidade de Movimento e Quantidade de Movimento Angular}

Para o cálculo das forças de inércia, calcula-se a Quantidade de Movimento $G$ e
a Quantidade de Movimento Angular $H$, para cada corpo, de acordo com as
equações~\ref{eq::qntmov} e \ref{eq::qntmovang}.
%
\begin{align}
%eq1
	\mathbf{G}_{k} &= m_{k} \cdot \mathbf{v}_{k} \label{eq::qntmov} \\
%eq2	
	\mathbf{H}_{k} &= In_{k} \cdot \boldsymbol\omega^{k} \label{eq::qntmovang}
\end{align}
%

\subsubsection{Forças de Inércia}

As forças de inércia são a derivada temporal das quantidades de movimento, com
respeito ao referencial inercial Z, conforme descrito pelas
equações~\ref{eq::finG} e \ref{eq::finH}.
%
\begin{align}
%eq1
	\dot{\mathbf{G}}_{k} &= \frac{^{Z}\mathrm{d}}{\mathrm{d} t} (m_{k} \cdot
	\mathbf{v}_{k}) \label{eq::finG} \\
%eq2	
	\dot{\mathbf{H}}_{k} &= \frac{^{Z}\mathrm{d}}{\mathrm{d} t} (In_{k} \cdot
	\mathbf{\boldsymbol\omega^{k}}_{k}) \label{eq::finH}	
\end{align}
%
No Sophia-Maple, obtém-se primeiro os vetores quantidade de movimento e, em
seguida, constrói-se o \texttt{Kvector} das quantidades de movimento com a
função \texttt{KM} armazendado na variável \texttt{KMG}. Um função especial para
diferenciação de \texttt{Kvectors}, \texttt{Kfdt} é aplicada em \texttt{KMG} para
calcular os vetores das forças de inércia.

Vale notar que o Sophia-Maple adiciona um sufixo t aos termos que foram
derivados com respeito ao tempo.
Logo, as coordenadas generalizadas, q1,\ldots,qn, quando derivadas no tempo
resultam em q1t,\ldots,qnt. Este formato auxilirá a substituição destes termos
para solução das \textit{kinematic differential equations} (kde), conforme visto
na seção~\ref{sec::sophia-kane}.

O algoritmo para definir as Forças de Inércia do sistema no Sophia-Maple é o
seguinte:

\medskip \noindent {\tt > for i from 1 to 6 do \\
\indent G||corpo[i]:= m||corpo[i] \&** v||corpo[i] \\
end do: \# Define as Quantidades de Movimento}

\medskip \noindent {\tt > for i from 1 to 6 do \\
\indent H||corpo[i]:= In||corpo[i] \&** w||corpo[i] \\
end do: \# Define as Quantidades de Movimento Angular}

\medskip \noindent {\tt > KMG:= subs(kde, KM[G||corpo, H||corpo]): \\
\# Define o Kvector das Quantidades de Movimento generalizadas}

\medskip \noindent {\tt > FIN:= subs(kde, Z Kfdt KMG): \\
\# Define o Kvector das Forças de Inércia}


\subsubsection{Forças Externas}

Uma das vantagens do método de Kane é não ser necessário avaliar as forças
internas, ou de restrição entre os corpos dos sistema. O motivo é que, ao se
projetarem as equações de equilíbrio dinâmico no hiperplano tangente, essas
forças desaparecem.

Logo, apenas as forças externas precisam ser modeladas para obter as equações de
movimento. No modelo do braço robótico, estas forças são o peso, os torques das
juntas e os torques de controle PID, em cada elo.

A força peso atua aplicada ao centro de massa de cada corpo \textit{k} e é calculada
pela equação~\ref{eq::peso}:
%
\begin{equation}
	Peso_{k} = m_{k} \cdot \mathbf{g} \label{eq::peso}
\end{equation}
%
Onde $\mathbf{g}$ refere-se ao vetor da aceleração da gravidade, que atua sempre
no sentido de $-X$ no referencial inercial Z. É definido como:
%
\begin{equation}
	\mathbf{g} = [-9,81,~0,~0]^{Z}
\end{equation}
%
Os momentos externos são formados pelos torques dos atuadores em cada junta e
também os torques de controle PID. Neste momento é válido acrescentar uma
explicação rápida sobre a modelagem do controlador PID.

\subsubsection{Parâmetros de controle PID}

Para que o robô realize uma tarefa, é necessário seguir uma trajetória
previamente planejada. Uma trajetória pode ser simplesmente um conjunto de
posições de referência de cada junta, que varia no tempo, como foi abordado na
seção~\ref{sec::ikin_traj}. A variação das posição se dá pelo acionamento dos
torques em cada junta, que deve ser controlado para seguir a trajetória
planejada. 

Os fabricantes de robôs comerciais infelizmente não fornecem detalhes sobre o
método nem os parâmetros de controle utilizados.
Com o propósito de simular o controle do manipulador decidiu-se pela
simplicidade do método de controle PID.

Os parâmetros de controle PID são formados pelas variáveis proporcional,
integral e derivativa, ou $Kp$, $Td$ e $Ti$ respectivamente. Esses parâmetros
foram sintonizados para cada junta individualmente, fazendo-se simulações de
resposta para uma função degrau de referência. Os resultados mostraram que este
método é suficiente para seguir a trajetória e manter os erros dentro de uma
margem de tolerância aceitável. Alguns dos resultados são demonstrados no
Apêndice X\todo{Incluir apêndice para resultados PID}.

Como resultado da análise, encontrou-se os melhores resultados
para o conjunto de parâmetros apresentados na\todo{atualizar parâmetros PID}
Tabela~\ref{tab::pid}:
%
\begin{table}[h]
\centering
\caption{Parâmetros de controle PID em cada junta}
\label{tab::pid}
\begin{tabular}{@{}clll@{}}
\toprule
\textbf{Junta} & \textbf{Kp [Nm]} & \textbf{Ti [Nm]} & \textbf{Td [Nm]} \\ \midrule 
S              & 400         & 80000       & 3000        \\
L              & 2000        & 500000      & 15000       \\
U              & 1200        & 400000      & 12000       \\
R              & 100         & 100000      & 1000        \\
B              & 250         & 100000      & 1000        \\ \bottomrule
\end{tabular}
\end{table}
%

Logo, define-se as equações dos torques de controle para cada junta, em função
da diferença entre os parâmetros instantâneos e os de referência em cada junta.
O subíndice $k$ representa a lista de juntas, localizada na origem de cada
sistema de coordenadas de mesmo nome, variando em \{S,L,U,R,B\} e o
subíndice $i$ o número da coordenada generalizada associada.
%
\begin{equation}
	PID_{k} = Kp(q_i-q_i{ref}) + Ti\int_{t1}^{t2} (q_i-q_i{ref})dt +
	Td(u_i-u_i{ref}) \label{eq::pid}
\end{equation}
%
No Sophia-Maple declara-se os torques de controle representados na
equação~\ref{eq::pid} da seguinte forma:

\medskip \noindent {\tt > for k from 1 to 5 do \\
		 \indent PID\_||{corpo[k]}:= Kp*(q||k - q||k||ref) + Ti*int(q||k - q||k||ref,
		 t) + Td*(u||k - u||k||ref) \\
		 end do:}

\subsubsection{Momentos Externos}

Para obter os momentos externos que atuam em cada corpo, o primeiro passo é
definir os torques que atuam em cada junta. Para eliminar os momentos causados
pelas forças \texttt{Peso}, avaliou-se os torques das juntas com respeito ao
centro de massa de cada corpo. As equações~\ref{eq::tjuntasi} a
\ref{eq::tjuntasf} descrevem os torques externos e de controle que atuam em cada
junta.
\begin{align}
	\mathbf{TjZS} &= (TZS - PID_{S})\cdot[1,~0,~0]^Z \label{eq::tjuntasi} \\
	\mathbf{TjSL} &= (TSL - PID_{L})\cdot[0,~0,~1]^S \\
	\mathbf{TjLU} &= (TLU - PID_{U})\cdot[0,~0,~1]^L \\
	\mathbf{TjUR} &= (TUR - PID_{R})\cdot[0,~1,~0]^L \\
	\mathbf{TjRB} &= (TRB - PID_{B})\cdot[0,~0,~1]^B \label{eq::tjuntasf}
\end{align}
%
As equações~\ref{eq::mexi} a \ref{eq::mexf} calculam o somatório dos momentos
externos em cada corpo. Nota-se que o torque aplicado em qualquer junta causa
um par de torques de ação e reação nos elos adjacentes. As variáveis $Mex_k$ são
grandezas vetoriais que representam o momentos externos resultante em cada
corpo.
%
\begin{align}
	\mathbf{Mex_{Z}} &= - \mathbf{TjZS } \label{eq::mexi}\\
	\mathbf{Mex_{S}} &= \mathbf{TjZS} - \mathbf{TjSL }\\
	\mathbf{Mex_{L}} &= \mathbf{TjLU }- \mathbf{TjSL }\\
	\mathbf{Mex_{U}} &= \mathbf{TjUR }- \mathbf{TjLU }\\
	\mathbf{Mex_{R}} &= \mathbf{TjRB }- \mathbf{TjUR }\\
	\mathbf{Mex_{B}} &= - \mathbf{TjRB} \label{eq::mexf}
	\end{align}
%
A Figura~\ref{fig::sisfex} ilustra, em vista explodida, o equilíbrio das forças e
momentos externos em cada elo do manipulador.
%
\begin{figure}[h]
    \centering
    \begin{subfigure}[b]{0.6\textwidth}
        \includegraphics[width=\textwidth]{figs/forcas_ext}
        \caption{Forças externas em cada elo}
        \label{fig::fex}
    \end{subfigure}
    \quad %add desired spacing between images, e. g. ~, \quad, \qquad, \hfill
    % etc.
      %(or a blank line to force the subfigure onto a new line)
    \begin{subfigure}[b]{0.6\textwidth}
        \includegraphics[width=\textwidth]{figs/mom_ext}
        \caption{Momentos externos em cada elo}
        \label{fig::mex}
    \end{subfigure}
    \caption{Sistema de forças externas}\label{fig::sisfex}
\end{figure}
%

Nota-se novamente que, pelo método de Kane, não é preciso introduzir as forças
internas, de restrição ou de contato entre os corpos, porque estas não
contribuem para as equações de movimento e desaparecem quando o sistema de
equações de equilíbrio dinâmico são projetads no hiperplano tangente, $\tau$.

No Sophia-Maple os vetores dos momentos externos resultantes são armazenadas em
\texttt{Evectors}. A sequência de equações~\ref{eq::tjuntasi} a \ref{eq::mexf}
torna-se:

\medskip \noindent {\tt > \# Torques nas juntas} \\
		 \noindent {\tt > TjZS:= Evector(TZS - PID\_S,~0,~0,~S) } \\
		 \noindent {\tt > TjSL:= Evector(0,~0,~TSL - PID\_L,~L) } \\
		 \noindent {\tt > TjLU:= Evector(0,~0,~TLU - PID\_U,~U) } \\
		 \noindent {\tt > TjUR:= Evector(0,~TUR - PID\_R,~0,~R) } \\
		 \noindent {\tt > TjRB:= Evector(0,~0,~TUR - PID\_B,~B) }

\medskip \noindent {\tt > \# Momentos externos em cada elo} \\
		 \noindent {\tt > for k from 1 to 5 do \\
		 \indent Mex||k:= Tj||{k-1}||{k}  - Tj||{k}||{k+1} \\
		 end do:} \\
		 \noindent {\tt > MexB:= - TjRB:} \medskip

		 
As forças e momentos externos podem ser agrupadas em um único vetor para
auxiliar a projeção destas em $\tau$. Novamente, faz-se uso da função
\texttt{KM}, o que retorna um \texttt{Kvector} contendo todas as forças e
momentos, descritos em cada sistema de referência.

\medskip \noindent {\tt > FEX:= KM[Fex||corpo,~Mex||corpo]:}

		 
\subsubsection{Forças de Inércia e Externas Generalizadas}

Estas são as forças externas e de inércia FEX e FIN, quando projetadas no
hiperplano tangente, $\tau$. Para a projeção, faz-se uso da função
\texttt{\&kane}, do Sophia-Maple, o que retorna as equações implícitas
generalizadas de cada corpo:

\medskip \noindent {\tt > FEXg:= tau \&kane FEX:} \\
		 \noindent {\tt > FINg:= tau \&kane FIN:}
		 
\subsubsection{Equações de Movimento}

Finalmente, as equações de movimento são formadas pelo equilíbrio dinâmico entre
as forças externas e externas generalizadas obtidas da projeção em $\tau$, de
acordo com a equação~\ref{eq::eqdin}:
%
\begin{equation}
	(FINg - FEXg)_{k} = 0 \label{eq::eqdin}
\end{equation}
%
O subíndice \textit{k} representa a lista de corpos \{Z,S,L,U,R,B\}. Como o
corpo Z está fixo no referencial inercial SC-Z, sua equação de movimento
torna-se a solução trivial $0=0$ e portanto, não fará parte do sistema. Obtém-se
então um conjunto de 5 equações de movimento, associadas aos 5 gdl do robô.

No Sophia-Maple atribui-se o conjunto de equações~\ref{eq::eqdin} à
variável \texttt{kane}, formando uma lista das equações de movimento. Portanto:

\medskip \noindent {\tt > kane:= FINg - FEXg = 0} \medskip

As equações denominadas \textit{kinematic differential equations}, ou
\texttt{kde}, completam o sistema de equações diferenciais que descrevem o
movimento do robô.
Para os 5 graus de liberdade do manipulador, tem-se 5 kde. As
equações~\ref{eq::kde5i} a \ref{eq::kde5f} descrevem o kde:
%
\begin{align}
	u_{1}(t) &= \frac{\mathrm{d} }{\mathrm{d} t}q_{1}(t) \label{eq::kde5i} \\
	u_{2}(t) &= \frac{\mathrm{d} }{\mathrm{d} t}q_{2}(t) \\
	u_{3}(t) &= \frac{\mathrm{d} }{\mathrm{d} t}q_{3}(t) \\
	u_{4}(t) &= \frac{\mathrm{d} }{\mathrm{d} t}q_{4}(t) \\
	u_{5}(t) &= \frac{\mathrm{d} }{\mathrm{d} t}q_{5}(t) \label{eq::kde5f}	
\end{align}
%
Somando-se esse sistema às equações de movimento e atribuindo à variável
\texttt{eq\_mov}, no Sophia-Maple tem-se:

\medskip \noindent {\tt > eq\_mov:= kane union kde:} \medskip

Logo, tem-se um sistema de 10 equações diferenciais ordinárias, não-lineares
(equações~\ref{eq::eqdin} a \ref{eq::kde5f}), cujas incógnitas são as
coordenadas generalizadas $q_{1}(t),\ldots, q_{5}(t)$ e as velocidades angulares
$u_{1}(t),\ldots, u_{5}(t)$.

Vale ressaltar que, para o sistema de apenas 5 equações de movimento simbólicas
associadas aos 5 graus de liberdade, as expressões são extensas demais para
serem representadas neste texto, o que ocuparia diversas páginas e obviamente
não traria nenhum valor à discussão deste tópico. Por isso, limita-se a
representação do sistema à equação~\ref{eq::eqdin}.

A função \texttt{cost} do Maple retorna o número de operações algébricas e de
funções de uma determinada equação ou sistema de equações fornecendo um
parâmetro para o usuário avaliar o tamanho das expressões e o custo
computacional do modelo.
Para se ter uma ideia, o custo do sistema de equações de movimento, representado
na forma puramente simbólica em \ref{eq::eqdin}, tem  a seguinte estrutura:
\begin{equation*}
	18171\,{\it additions}+59804\,{\it multiplications}+39998\,{\it 
functions}
\end{equation*}
%
Porém, até então não foram substituidos os parâmetros numéricos do robô, nas
variáveis simbólicas . Este procedimento simplifica o sistema, porque muitos
termos são zerados. Além disso, é possível fazer uso da função \texttt{simplify}
do Maple, que é um poderoso conjunto de rotinas para simplificação algébrica de
expressões. Fazendo uso desta função e da substituição dos parâmetros numéricos
nas equações de movimento, obtemos o novo custo algébrico das equações:
%
\begin{equation*}
	5676\,{\it additions}+6992\,{\it multiplications}+1835\,{\it functions}
\end{equation*}
%
Nota-se a grande vantagem de realizar este procedimento, porque ao reduzir-se
drasticamente o número de termos e funções, reduz-se também o custo
computacional e por consequência o tempo para o cálculo da solução.

\subsubsection{Problema de Valor Inicial -- PVI}

Para resolver o sistema diferencial é necessário fornecer as condições de
contorno do problema. Como as equações estão no domínio do tempo, são fornecidas
as condições iniciais das variáveis de estado $q_{1}(0),\ldots, q_{5}(0)$ e
$u_{1}(t),\ldots, u_{5}(0)$.

Será adotado neste modelo que qualquer trajetória será iniciada a partir da
configuração incial do robô, ou seja:
%
\begin{equation}
	q_{1}(0) = \ldots = q_{5}(0) = u_{1}(0) = \ldots = u_{5}(0) = 0
	\label{eq::condini}
\end{equation}
%
O sistema completo será portanto formado pelas 10 equações de movimento
diferenciais e não lineares (\ref{eq::eqdin} a \ref{eq::kde5f}), com as 10
equações de valor incial definidas em~\ref{eq::condini}.

Para definir esse sistema no Sophia-Maple, primeiro cria-se a lista com as
equações de valor inicial e então adiciona-as ao sistema, utilizando a função
\texttt{union}:

\medskip \noindent {\tt > cond\_ini:= \{seq(q||i(0) = 0, i=1..5), seq(u||i(0) =
0, i=1..5)\}} \\ 
		 \noindent {\tt > sistema:= eq\_mov union condini:} \medskip

A solução deste sistema depende ainda da definição dos seguintes parâmetros:
%
\begin{itemize}
  \item{Torques nas juntas: TZS, TSL, TLU, TUR, TRB}
  \item{Coordenadas de referência dos ângulos de juntas: 
  		\\ $q_{1}ref, q_{2}ref, q_{3}ref, q_{4}ref, q_{5}ref$}
  \item{Velocidades angulares de referências das juntas: 
  		\\ $u_{1}ref, u_{2}ref, u_{3}ref, u_{4}ref, u_{5}ref$}
\end{itemize}
%
A trajetória efetuada pelo manipulador é então consequência da solução do
sistema, para um conjunto de parâmetros fornecidos. Para realizar uma trajetória
desejada, deve-se fornecer os parâmetros de referência e torques das juntas ao
longo do tempo que resultam naquela trajetória.

Se tal trajetória é descrita pela posição e orientação da ferramenta acoplada ao
último elo do manipulador, os parâmetros das juntas, tais que a ferramenta
segue aquela trajetória, devem ser determinados pelo cálculo da Cinemática
Inversa.


\subsection{Cinemática Inversa}\label{sec::ikin_mh12}

Como o manipulador MOTOMAN MH12 é do tipo antropomórfico 6R com pulso esférico,
a modelagem da cinemática inversa se resume em encontrar os parâmetros das
juntas que satisfazem ao problema desacoplado, detalhado na
seção~\ref{sec::ikin_traj}, ou seja, as funções $q_{1}, q_{2}, q_{3}$ que
satisfazem a posição e $q_{4}, q_{5}, q_{6}$ que satisfazem a orientação da
ferramenta.

A posição final da ferramenta pode ser portanto expressa como função da posição
de sua extremidade e orientação em termos das coordenadas generalizadas, de
acordo com a equação~\ref{eq::posf}.
%
\begin{equation}
	\mathbf{x}_{f} = \begin{bmatrix}
		\mathbf{p}_{f} \\ \boldsymbol{\Phi}_{f}
	\end{bmatrix}
	\label{eq::posf}	
\end{equation}
%
\noindent onde: 
%
\begin{align}
\mathbf{p}_{f}^Z &= [x_f,y_f,z_f]^Z \\
\boldsymbol{\Phi}_{f}^Z &= [\phi,\theta,\psi]^Z
\end{align}
%

\todo[inline]{Incluir figura representando a posição e orientação final da
ferramenta}

\subsubsection{Cálculo da posição do pulso}

A primeira tarefa será calcular a posição da ferramenta em termos das
coordenadas generalizadas.
Como visto na seção~\ref{sec::ikin_traj}, pode-se expressá-la convenientemente
pela posição da origem do pulso, porque esta só depende das coordenadas $q_1, q_2$ e $q_3$.

A posição da ponta da ferramenta, $p_{f}$, é então a posição da origem do pulso,
$p_{w}$ em SC-R, somada ao vetor das dimensões da ferramenta, no referencial
SC-B:
\begin{equation}
	\mathbf{p}_{f}^Z = \mathbf{p}_{w} + [d_{x}, d_{y}, d_{z}]^B \label{eq::posf}
\end{equation}
%
Pelo desenvolvimento da cinemática direta, na seção~\ref{sec::dkin}, pode-se
expressar a posição de qualquer ponto da cadeia cinemática em um dado
referencial. Como o pulso tem origem no sistema de coordenadas SC-R, então:
%
\begin{equation} \label{eq::pwpr}
	\mathbf{p}_{w} =~^Z{\mathbf{p}}^R 
\end{equation}
%
Recorrendo às equações~\ref{eq::ikinq1} a \ref{eq::ikinq6}, desenvolvidas na
seção~\ref{sec::ikin_traj}, pelo método geométrico para a solução da cinemática
inversa deste tipo de manipulador, tem-se:
%
\begin{align*}
	q1 &= \atantwo (z_w,y_w) - \atantwo (d, \pm \sqrt{y_w^2 + z_w^2 - d^2}) \\
	q2 &= \atantwo (r,s) - \atantwo (\pm  \sqrt{1-E^2}, E) \\
	q3 &= \atantwo (\pm \sqrt{1-D^2}, D) - \frac{\pi}{2} + \atantwo (h, a3)
\end{align*}
%
Onde:
%
\begin{align*}
	D &= \frac{r^2 + s^2 -a2^2 - a3^2}{2 \cdot a2 \cdot a3} \\
	E &= - \frac{a3^2 - a2^2 - r^2 - s^2}{2 \cdot a2 \cdot \sqrt{r^2 + s^2}}
\end{align*}
%
Uma análise das expressões acima permite relacionar os termos geométricos
do robô genérico com os parâmetros fornecidos do MOTOMAN MH12. Substiui-se
portanto estes termos de acordo com as relações:
%
\begin{align}
	r &= \sqrt{x_w^2 + y_w^2 - d^2} - pSLy \\
	s &= x_w - (pZSx + pSLx) \\
	d &= 0 \\
	h &= pURx \\
	a2 &= pLUx \\
	a3n &= pURy \\
	a3 &= \sqrt{h^2 + a3n^2}
\end{align}
%
E obtém-se:
%
\begin{align}
	q1 &= \atantwo (z_w,y_w) \label{eq::q1ik} \\
	q2 &= \atantwo ( \sqrt {y_w^2 + z_w^2}- pSLy, x_w - pZSx - pSLx ) \nonumber \\
	   &- \atantwo ( \pm \sqrt {-E^2+1}, E ) \\
	q3 &= \atantwo ( \pm \sqrt {-{{\it D}}^{2}+1},{\it D} ) -\pi /2 +
\atantwo ( {\it pURx},{\it pURy} ) \label{eq::q3ik}
\end{align}
%
Onde:
%
\begin{align}
	D &= \textstyle \frac{1}{2}\,{\frac {-{{\it pLUx}}^{2}-{{\it pURx}}^{2}-{{\it
	pURy}}^{2}+ \left( \sqrt {{{\it y_w}}^{2}+{{\it z_w}}^{2}}-{\it pSLy} \right) ^{2
		}+ \left( {\it x_w}-{\it pZSx}-{\it pSLx} \right) ^{2}}{{\it pLUx}\,
		\sqrt {{{\it pURx}}^{2}+{{\it pURy}}^{2}}}} \\
	E &= \textstyle {-\frac{1}{2}\,{\frac {-{{\it pLUx}}^{2}+{{\it pURx}}^{2}+{{\it
		pURy}}^{2}- \left( \sqrt {{{\it y_w}}^{2}+{{\it z_w}}^{2}}-{\it pSLy} \right)
		^{2 }- \left( {\it x_w}-{\it pZSx}-{\it pSLx} \right) ^{2}}{{\it pLUx}\,
		\left[ \left( \sqrt {{{\it y_w}}^{2}+{{\it z_w}}^{2}}-{\it pSLy}
 		\right) ^{2}+ \left( {\it x_w}-{\it pZSx}-{\it pSLx} \right) ^{2}
 		\right]^{1/2}}}}
\end{align}
%
Determina-se portanto, pelo método geométrico, as coordenadas $q_1, q_2$ e
$q_3$ em função da posição do pulso e dos parâmetros geométricos do robô. Note que $x_w,
y_w, z_w$ são as coordenadas da posição do pulso, no referencial inercial e que
para calcular a posição da ferramenta, pela equação~\ref{eq::pwpr} precisa-se
ainda definir sua orientação.

Note-se também que existem 4 soluções para cada posição do pulso. Se
considerar-se os limites dos ângulos das juntas do robô, pode-se limitar o
número de soluções. Para exemplificar, a Figura~\ref{fig::multsol} demonstra
duas soluções para a posição $\mathbf{p}_{w} = [0,7,~ 0,8,~ 0]^Z$:
em~\ref{fig::elbowup} com o cotovelo para cima e em~\ref{fig::elbowdown} com o
cotovelo para baixo.

\missingfigure[figheight=80mm]{Elbow up/down}


\subsubsection{Cálculo da orientação da ferramenta}

Nesta etapa, deseja-se calcular a orientação da ferramenta, em relação ao
referencial inercial. Para isso são utilizados os ângulos $\phi,\theta,\psi$
para reresentar os ângulos de Euler das 3 rotações que orientam o referencial do
pulso na direção desejada.

Recorrendo novamente ao desenvolvimento da cinemática inversa geral para este
tipo de manipulador, da seção~\ref{sec::ikin_traj}, obteve-se da
equação~\ref{eq::rut} a relação:
%
\begin{equation*}
	R_{U}^{T} = (R_{Z}^{U})^T R_{yzy}
\end{equation*}
%
Onde $R_{zyz}$ representa a matriz rotação pelos ângulos de Euler
$\phi,\theta,\psi$, em torno dos eixos $Y,Z,Y$ respectivamente.

As matrizes de rotação $(R_{Z}^{U})^T$ e $R_{U}^{T}$ são calculadas para os
valores de $q_1, q_2$ e $q_3$ das equações~\ref{eq::q1ik} a \ref{eq::q3ik}.
Assim, a equação~\ref{eq::rutik} fornece um sistema de 9 equações e 6
incógnitas, se consideradas as funções senos e cossenos de $q_4, q_5$ e $q_6$ a serem
determinadas.
%
\begin{multline} \label{eq::rut}
%eq1
	 \left[ \begin {array}{ccc} {\it c4}\,{\it c5}\,{\it c6}-{\it s4}\,{
\it s6}&-{\it c4}\,{\it s5}&{\it c4}\,{\it c5}\,{\it s6}+{\it c6}\,{
\it s4}\\ \noalign{\medskip}{\it s5}\,{\it c6}&{\it c5}&{\it s5}\,{
\it s6}\\ \noalign{\medskip}-{\it c5}\,{\it c6}\,{\it s4}-{\it c4}\,{
\it s6}&{\it s4}\,{\it s5}&-{\it c5}\,{\it s4}\,{\it s6}+{\it c4}\,{
\it c6}\end {array} \right] = \\
%eq2
	 \left[ \begin {array}{ccc} {\it c2}\,{\it c3}-{\it s2}\,{\it s3}&-{
\it c2}\,{\it s3}-{\it s2}\,{\it c3}&0\\ \noalign{\medskip}{\it c1}\,{
\it c2}\,{\it s3}+{\it c1}\,{\it s2}\,{\it c3}&{\it c1}\,{\it c2}\,{
\it c3}-{\it c1}\,{\it s2}\,{\it s3}&-{\it s1}\\ \noalign{\medskip}{
\it s1}\,{\it c2}\,{\it s3}+{\it s1}\,{\it s2}\,{\it c3}&{\it s1}\,{
\it c2}\,{\it c3}-{\it s1}\,{\it s2}\,{\it s3}&{\it c1}\end {array}
 \right]^T \cdot \\
%eq3
	\cdot \left[ \begin {array}{ccc} c\phi \,c\theta \,c\psi -s\phi \,s\psi &-c
\phi \,s\theta &c\phi \,c\theta \,s\psi +s\phi \,c\psi 
\\ \noalign{\medskip}s\theta \,c\psi &c\theta &s\theta \,s\psi 
\\ \noalign{\medskip}-s\phi \,c\theta \,c\psi -c\phi \,s\psi &s\phi \,
s\theta &-s\phi \,c\theta \,s\psi +c\phi \,c\psi \end {array} \right] 
\end{multline}
%

Analisando o lado esquerdo da equação~\ref{eq::rut} pode-se determinar
facilmente a solução para $\cos(q5)$, porque este será diretamente o resultado
alocado no termo $[2,2]$ da matriz 3x3 resultante do lado direito da equação, ou
seja:
%
\begin{multline}
\cos(q5) = {\it c2}\,{\it c3}\,s\phi \,{\it s1}\,s\theta -s\phi \,{\it s1}\,{\it 
		s2}\,{\it s3}\,s\theta +c\phi \,{\it c2}\,{\it s3}\,s\theta +
		\\ +c\phi \,{\it c3}\,{\it s2}\,s\theta +{\it c1}\,{\it c2}\,{\it c3}\,c\theta -{
		\it c1}\,{\it s2}\,{\it s3}\,c\theta 
\end{multline}
%
E seu seno é calculado por:
%
\begin{equation}
	\sin(q5) = \sqrt{1-\cos(q5)^2}
\end{equation}
%
Logo, utilizando a relação trigonométrica, $\sin(q5)/\cos(q5) = \tan(q5)$,
e invertendo a função tangente, determina-se:
%
\begin{equation}
	q5 = \atantwo(\sqrt{1-\cos(q5)^2}, \cos(q5))
\end{equation}
%

Para determinar $q4$ analisa-se novamente a matriz $R_{U}^{T}$. Se dividir o
termo $[3,2]$,  multiplicado por $(-1)$, pelo termo $[1,2]$, dos lados esquerdo
e direito da equação~\ref{eq::rut}, obtém-se uma expressão para $\tan(q4)$.
Invertendo a função tangente para obter $q4$:
\begin{multline} 
q4 = \atantwo( {{\it c1}\,s\phi \,s\theta -{\it s1}\,c\theta} , ~
 \left[  \left( s\phi \,{\it s1}\,{\it s3}-c\phi \,{\it c3} \right) {
\it c2}+{\it s2}\, \left( {\it c3}\,s\phi \,{\it s1}+c\phi \,{\it s3}
 \right)  \right] s\theta +
 \\ +{\it c1}\,c\theta \, \left( {\it c2}\,{\it 
s3}+{\it s2}\,{\it c3} \right) 
 )
\end{multline}
%
Similarmente à solução de $q4$, mas desta vez fazendo a divisão dos termos
$[2,3]$ por $[2,1]$, dos lados esquerdo e direito da equação~\ref{eq::rut},
encontra-se $q6$:
%
\begin{equation} \label{eq::q6ik}
	q6 = \atantwo ( {s6} , {c6} )
\end{equation}
%
Onde:
%
\begin{multline*}
	s6 = -{\it c2}\,{\it c3}\,s\phi \,s\psi \,{\it s1}\,c\theta +s\phi \,s\psi 
		\,{\it s1}\,{\it s2}\,{\it s3}\,c\theta +c\phi \,c\psi \,{\it c2}\,{
		\it c3}\,{\it s1}-c\phi \,c\psi \,{\it s1}\,{\it s2}\,{\it s3} +
		\\ -c\phi \,{\it c2}\,s\psi \,{\it s3}\,c\theta -c\phi \,{\it c3}\,s\psi \,{\it 
		s2}\,c\theta +{\it c1}\,{\it c2}\,{\it c3}\,s\psi \,s\theta -{\it c1}
		\,s\psi \,{\it s2}\,{\it s3}\,s\theta +
		\\ -c\psi \,{\it c2}\,s\phi \,{\it s3}-c\psi \,{\it c3}\,s\phi \,{\it s2}
\end{multline*}
\vspace{-15mm}
\begin{multline*}
	c6 = -c\psi \,{\it c2}\,{\it c3}\,s\phi \,{\it s1}\,c\theta +c\psi \,s\phi 
		\,{\it s1}\,{\it s2}\,{\it s3}\,c\theta -c\phi \,c\psi \,{\it c2}\,{
		\it s3}\,c\theta -c\phi \,c\psi \,{\it c3}\,{\it s2}\,c\theta 
		\\ -c\phi \,{\it c2}\,{\it c3}\,s\psi \,{\it s1}+c\phi \,s\psi \,{\it s1}\,{\it 
		s2}\,{\it s3}+c\psi \,{\it c1}\,{\it c2}\,{\it c3}\,s\theta -c\psi \,{
		\it c1}\,{\it s2}\,{\it s3}\,s\theta +
		\\ +{\it c2}\,s\phi \,s\psi \,{\it s3}+{\it c3}\,s\phi \,s\psi \,{\it s2}
\end{multline*}
%
Com o cálculo dos ângulos $q4, q5$ e $q6$ é possível determinar totalmente a
posição da ponta da ferramenta, pela equação~\ref{eq::posf}.
Como este ponto está alinhado ao eixo do efetuador, faz-se $dx = dy = 0$.
Reescrevendo a equação no referencial inercial, as componentes do vetor
$\mathbf{p}_{f}^{Z}$ são:
%
\begin{multline}
	x_f =  \left[  \left( -{\it c4}\,{\it s5}\,{\it pBTy}+{\it pURx} \right) {
		\it c3}+ \left( -{\it c5}\,{\it pBTy}-{\it pURy} \right) {\it s3}+{
		\it pLUx} \right] {\it c2} +
		\\ -{\it s2}\, \left( {\it c5}\,{\it pBTy}+{
		\it pURy} \right) {\it c3}+{\it s3}\, \left( {\it c4}\,{\it s5}\,{\it 
		pBTy}-{\it pURx} \right) {\it s2}+
		\\ +{\it pZSx}+{\it pSLx}
\end{multline}
\vspace{-15mm}
\begin{multline}
	y_f =  \{ \left[  \left( -{\it c4}\,{\it s5}\,{\it pBTy}+{\it pURx}
 		\right) {\it c3}+ \left( -{\it c5}\,{\it pBTy}-{\it pURy} \right) {
		\it s3}+{\it pLUx} \right] {\it s2}+ 
		\\ + \left[  \left( {\it c5}\,{\it 
		pBTy}+{\it pURy} \right) {\it c3}-{\it s3}\, \left( {\it c4}\,{\it s5}
		\,{\it pBTy}-{\it pURx} \right)  \right] {\it c2}+{\it pSLy} \} {
		\it c1} +
		\\ -{\it s5}\,{\it s1}\,{\it s4}\,{\it pBTy}
\end{multline}
\vspace{-15mm}
\begin{multline}
	z_f =  \{  \left[ \left( -{\it c4}\,{\it s5}\,{\it pBTy}+{\it pURx}
 		\right) {\it c3}+ \left( -{\it c5}\,{\it pBTy}-{\it pURy} \right) {
		\it s3}+{\it pLUx} \right] {\it s2}+ 
		\\ + \left[ \left( {\it c5}\,{\it 
		pBTy}+{\it pURy} \right) {\it c3}-{\it s3}\, \left( {\it c4}\,{\it s5}
		\,{\it pBTy}-{\it pURx} \right)  \right] {\it c2}+{\it pSLy} \} {
		\it s1} +
		\\ +{\it c1}\,{\it s4}\,{\it s5}\,{\it pBTy}
\end{multline}

\todo[inline]{Pensar em mudar estas eqs de lugar}

Tem-se portanto, pelo conjunto de equações~\ref{eq::q3ik} a \ref{eq::q6ik}, a
solução cinemática inversa do manipulador MOTOMAN MH12.


\subsection{Tarefa e trajetória}



\subsection{Modelo teórico MBS -- Robô}


% -.~.-.~.-.~.-.~.-.~.-.~.-.~.-.~.-.~.-.~.-.~.-
\section{Modelo da base}

\subsection{Geometria e CAD}

\subsection{Matriz de Rigidez}

\subsection{Matriz de Amortecimento}

\subsection{Análise Elementos Finitos}

\subsection{Modelo teórico MBS -- Base}


% -.~.-.~.-.~.-.~.-.~.-.~.-.~.-.~.-.~.-.~.-.~.-
\section{Ensaio Experimental}

\subsection{Bancada experimental}

\subsection{Programas de aquisição dos dados experimentais}

\subsection{Tratamento dos dados}

\subsection{Cálculo dos parâmetros modais da estrutura}


% -.~.-.~.-.~.-.~.-.~.-.~.-.~.-.~.-.~.-.~.-.~.-
\section{Modelo acoplado robô e base}

\subsection{Base rígida}

\subsection{Base flexível}


% -.~.-.~.-.~.-.~.-.~.-.~.-.~.-.~.-.~.-.~.-.~.-
\section{Estudos de casos para avaliação do método}

\subsection{Trajetórias do efetuador}

\subsection{Base rígida}

\subsection{Base de testes}

\subsection{Base modular PRP}

\subsection{Base com pouca rigidez}
